{"version":3,"sources":["event_manager.js"],"names":[],"mappings":"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","file":"/Users/tbosch/projects/angular2/modules/angular2/src/core/events/event_manager.js","sourcesContent":["import {isBlank, BaseException, isPresent, StringWrapper} from 'angular2/src/facade/lang';\nimport {DOM} from 'angular2/src/dom/dom_adapter';\nimport {List, ListWrapper, MapWrapper} from 'angular2/src/facade/collection';\nimport {VmTurnZone} from 'angular2/src/core/zone/vm_turn_zone';\n\nvar BUBBLE_SYMBOL = '^';\n\nexport class EventManager {\n  _plugins: List<EventManagerPlugin>;\n  _zone: VmTurnZone;\n\n  constructor(plugins: List<EventManagerPlugin>, zone: VmTurnZone) {\n    this._zone = zone;\n    this._plugins = plugins;\n    for (var i = 0; i < plugins.length; i++) {\n      plugins[i].manager = this;\n    }\n  }\n\n  addEventListener(element, eventName: string, handler: Function) {\n    var shouldSupportBubble = eventName[0] == BUBBLE_SYMBOL; \n    if (shouldSupportBubble) {\n      eventName = StringWrapper.substring(eventName, 1); \n    }\n\n    var plugin = this._findPluginFor(eventName);\n    plugin.addEventListener(element, eventName, handler, shouldSupportBubble);\n  }\n\n  getZone(): VmTurnZone {\n    return this._zone;\n  }\n\n  _findPluginFor(eventName: string): EventManagerPlugin {\n    var plugins = this._plugins;\n    for (var i = 0; i < plugins.length; i++) {\n      var plugin = plugins[i];\n      if (plugin.supports(eventName)) {\n        return plugin;\n      }\n    }\n    throw new BaseException(`No event manager plugin found for event ${eventName}`);\n  }\n}\n\nexport class EventManagerPlugin {\n  manager: EventManager;\n\n  // We are assuming here that all plugins support bubbled and non-bubbled events.\n  // That is equivalent to having supporting $event.target\n  // The bubbling flag (currently ^) is stripped before calling the supports and \n  // addEventListener methods.\n  supports(eventName: string): boolean {\n    return false;\n  }\n\n  addEventListener(element, eventName: string, handler: Function,\n      shouldSupportBubble: boolean) {\n    throw \"not implemented\";\n  }\n}\n\nexport class DomEventsPlugin extends EventManagerPlugin {\n  manager: EventManager;\n\n  // This plugin should come last in the list of plugins, because it accepts all\n  // events.\n  supports(eventName: string): boolean {\n    return true;\n  }\n\n  addEventListener(element, eventName: string, handler: Function,\n      shouldSupportBubble: boolean) {\n    var outsideHandler = shouldSupportBubble ?\n      DomEventsPlugin.bubbleCallback(element, handler, this.manager._zone) :\n      DomEventsPlugin.sameElementCallback(element, handler, this.manager._zone);\n\n    this.manager._zone.runOutsideAngular(() => {\n      DOM.on(element, eventName, outsideHandler);\n    });\n  }\n\n  static sameElementCallback(element, handler, zone) {\n    return (event) => {\n        if (event.target === element) {\n          zone.run(() => handler(event));\n        }\n      };\n  }\n\n  static bubbleCallback(element, handler, zone) {\n    return (event) => zone.run(() => handler(event));\n  }\n}\n"]}