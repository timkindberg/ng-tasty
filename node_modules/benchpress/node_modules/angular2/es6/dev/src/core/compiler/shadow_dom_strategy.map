{"version":3,"sources":["shadow_dom_strategy.js"],"names":[],"mappings":"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","file":"/Users/tbosch/projects/angular2/modules/angular2/src/core/compiler/shadow_dom_strategy.js","sourcesContent":["import {Injectable} from 'angular2/di';\nimport {Type, isBlank, isPresent, int, StringWrapper, assertionsEnabled} from 'angular2/src/facade/lang';\nimport {List, ListWrapper, MapWrapper, Map} from 'angular2/src/facade/collection';\nimport {PromiseWrapper} from 'angular2/src/facade/async';\n\nimport {DOM} from 'angular2/src/dom/dom_adapter';\n\nimport * as viewModule from './view';\n\nimport {LightDom} from './shadow_dom_emulation/light_dom';\nimport {ShadowCss} from './shadow_dom_emulation/shadow_css';\n\nimport {StyleInliner} from './style_inliner';\nimport {StyleUrlResolver} from './style_url_resolver';\n\nimport {DirectiveMetadata} from './directive_metadata';\n\nimport * as NS from './pipeline/compile_step';\nimport {CompileElement} from './pipeline/compile_element';\nimport {CompileControl} from './pipeline/compile_control';\n\nvar _EMPTY_STEP;\n\n// Note: fill _EMPTY_STEP to prevent\n// problems from cyclic dependencies\nfunction _emptyStep() {\n  if (isBlank(_EMPTY_STEP)) {\n    _EMPTY_STEP = new _EmptyCompileStep();\n  }\n  return _EMPTY_STEP;\n}\n\nexport class ShadowDomStrategy {\n  attachTemplate(el, view:viewModule.View) {}\n  constructLightDom(lightDomView:viewModule.View, shadowDomView:viewModule.View, el): LightDom { return null; }\n\n  /**\n   * An optional step that can modify the template style elements.\n   *\n   * @param {DirectiveMetadata} cmpMetadata\n   * @param {string} templateUrl the template base URL\n   * @returns {CompileStep} a compile step to append to the compiler pipeline\n   */\n  getStyleCompileStep(cmpMetadata: DirectiveMetadata, templateUrl: string): NS.CompileStep {\n    return _emptyStep();\n  }\n\n  /**\n   * An optional step that can modify the template elements (style elements exlcuded).\n   *\n   * This step could be used to modify the template in order to scope the styles.\n   *\n   * @param {DirectiveMetadata} cmpMetadata\n   * @returns {CompileStep} a compile step to append to the compiler pipeline\n   */\n  getTemplateCompileStep(cmpMetadata: DirectiveMetadata): NS.CompileStep { return _emptyStep(); }\n\n  /**\n   * The application element does not go through the compiler pipeline.\n   *\n   * This methods is called when the root ProtoView is created and to optionnaly update the\n   * application root element.\n   *\n   * @see ProtoView.createRootProtoView\n   *\n   * @param {DirectiveMetadata} cmpMetadata\n   * @param element\n   */\n  shimAppElement(cmpMetadata: DirectiveMetadata, element) {}\n}\n\n/**\n * This strategy emulates the Shadow DOM for the templates, styles **excluded**:\n * - components templates are added as children of their component element,\n * - styles are moved from the templates to the styleHost (i.e. the document head).\n *\n * Notes:\n * - styles are **not** scoped to their component and will apply to the whole document,\n * - you can **not** use shadow DOM specific selectors in the styles\n */\n@Injectable()\nexport class EmulatedUnscopedShadowDomStrategy extends ShadowDomStrategy {\n  _styleUrlResolver: StyleUrlResolver;\n  _styleHost;\n\n  constructor(styleUrlResolver: StyleUrlResolver, styleHost) {\n    super();\n    this._styleUrlResolver = styleUrlResolver;\n    this._styleHost = styleHost;\n  }\n\n  attachTemplate(el, view:viewModule.View) {\n    DOM.clearNodes(el);\n    _moveViewNodesIntoParent(el, view);\n  }\n\n  constructLightDom(lightDomView:viewModule.View, shadowDomView:viewModule.View, el): LightDom {\n    return new LightDom(lightDomView, shadowDomView, el);\n  }\n\n  getStyleCompileStep(cmpMetadata: DirectiveMetadata, templateUrl: string): NS.CompileStep {\n    return new _EmulatedUnscopedCssStep(cmpMetadata, templateUrl, this._styleUrlResolver,\n      this._styleHost);\n  }\n\n  getTemplateCompileStep(cmpMetadata: DirectiveMetadata): NS.CompileStep {\n    return new _BaseEmulatedShadowDomStep();\n  }  \n}\n\n/**\n * This strategy emulates the Shadow DOM for the templates, styles **included**:\n * - components templates are added as children of their component element,\n * - both the template and the styles are modified so that styles are scoped to the component\n *   they belong to,\n * - styles are moved from the templates to the styleHost (i.e. the document head).\n *\n * Notes:\n * - styles are scoped to their component and will apply only to it,\n * - a common subset of shadow DOM selectors are supported,\n * - see `ShadowCss` for more information and limitations.\n */\n@Injectable()\nexport class EmulatedScopedShadowDomStrategy extends EmulatedUnscopedShadowDomStrategy {\n  _styleInliner: StyleInliner;\n\n  constructor(styleInliner: StyleInliner, styleUrlResolver: StyleUrlResolver, styleHost) {\n    super(styleUrlResolver, styleHost);\n    this._styleInliner = styleInliner;\n  }\n\n  getStyleCompileStep(cmpMetadata: DirectiveMetadata, templateUrl: string): NS.CompileStep {\n    return new _EmulatedScopedCssStep(cmpMetadata, templateUrl, this._styleInliner,\n      this._styleUrlResolver, this._styleHost);\n  }\n\n  getTemplateCompileStep(cmpMetadata: DirectiveMetadata): NS.CompileStep {\n    return new _ShimShadowDomStep(cmpMetadata);\n  }\n\n  shimAppElement(cmpMetadata: DirectiveMetadata, element) {\n    var cmpType = cmpMetadata.type;\n    var hostAttribute = _getHostAttribute(_getComponentId(cmpType));\n    DOM.setAttribute(element, hostAttribute, '');\n  }\n}\n\n/**\n * This strategies uses the native Shadow DOM support.\n *\n * The templates for the component are inserted in a Shadow Root created on the component element.\n * Hence they are strictly isolated.\n */\n@Injectable()\nexport class NativeShadowDomStrategy extends ShadowDomStrategy {\n  _styleUrlResolver: StyleUrlResolver;\n\n  constructor(styleUrlResolver: StyleUrlResolver) {\n    super();\n    this._styleUrlResolver = styleUrlResolver;\n  }\n\n  attachTemplate(el, view:viewModule.View){\n    _moveViewNodesIntoParent(DOM.createShadowRoot(el), view);\n  }\n\n  getStyleCompileStep(cmpMetadata: DirectiveMetadata, templateUrl: string): NS.CompileStep {\n    return new _NativeCssStep(templateUrl, this._styleUrlResolver);\n  }\n}\n\nclass _BaseEmulatedShadowDomStep extends NS.CompileStep {\n  process(parent:CompileElement, current:CompileElement, control:CompileControl) {\n    if (current.ignoreBindings) {\n      return;\n    }\n    var nodeName = DOM.nodeName(current.element);\n    if (StringWrapper.equals(nodeName.toUpperCase(), 'CONTENT')) {\n      var attrs = current.attrs();\n      var selector = MapWrapper.get(attrs, 'select');\n      current.contentTagSelector = isPresent(selector) ? selector : '';\n\n      var contentStart = DOM.createScriptTag('type', 'ng/contentStart');\n      if (assertionsEnabled()) {\n        DOM.setAttribute(contentStart, 'select', current.contentTagSelector);\n      }\n      var contentEnd = DOM.createScriptTag('type', 'ng/contentEnd');\n      DOM.insertBefore(current.element, contentStart);\n      DOM.insertBefore(current.element, contentEnd);\n      DOM.remove(current.element);\n\n      current.element = contentStart;\n    }    \n  }\n\n}\n\nclass _EmptyCompileStep extends NS.CompileStep {\n  process(parent:CompileElement, current:CompileElement, control:CompileControl) {\n  }\n}\n\n\nclass _ShimShadowDomStep extends _BaseEmulatedShadowDomStep {\n  _contentAttribute: string;\n\n  constructor(cmpMetadata: DirectiveMetadata) {\n    super();\n    var id = _getComponentId(cmpMetadata.type);\n    this._contentAttribute = _getContentAttribute(id);\n  }\n\n\n  process(parent:CompileElement, current:CompileElement, control:CompileControl) {\n    super.process(parent, current, control);\n    if (current.ignoreBindings) {\n      return;\n    }\n\n    // Shim the element as a child of the compiled component\n    DOM.setAttribute(current.element, this._contentAttribute, '');\n\n    // If the current element is also a component, shim it as a host\n    var host = current.componentDirective;\n    if (isPresent(host)) {\n      var hostId = _getComponentId(host.type);\n      var hostAttribute = _getHostAttribute(hostId);\n      DOM.setAttribute(current.element, hostAttribute, '');\n    }\n  }\n}\n\nclass _EmulatedUnscopedCssStep extends NS.CompileStep {\n  _templateUrl: string;\n  _styleUrlResolver: StyleUrlResolver;\n  _styleHost;\n\n  constructor(cmpMetadata: DirectiveMetadata, templateUrl: string,\n    styleUrlResolver: StyleUrlResolver, styleHost) {\n    super();\n    this._templateUrl = templateUrl;\n    this._styleUrlResolver = styleUrlResolver;\n    this._styleHost = styleHost;\n  }\n\n  process(parent:CompileElement, current:CompileElement, control:CompileControl) {\n    var styleEl = current.element;\n    var cssText = DOM.getText(styleEl);\n    cssText = this._styleUrlResolver.resolveUrls(cssText, this._templateUrl);\n    DOM.setText(styleEl, cssText);\n    DOM.remove(styleEl);\n\n    if (!MapWrapper.contains(_sharedStyleTexts, cssText)) {\n      // Styles are unscoped and shared across components, only append them to the head\n      // when there are not present yet\n      MapWrapper.set(_sharedStyleTexts, cssText, true);\n      _insertStyleElement(this._styleHost, styleEl);\n    }\n  }\n}\n\nclass _EmulatedScopedCssStep extends NS.CompileStep {\n  _templateUrl: string;\n  _component: Type;\n  _styleInliner: StyleInliner;\n  _styleUrlResolver: StyleUrlResolver;\n  _styleHost;\n\n  constructor(cmpMetadata: DirectiveMetadata, templateUrl: string, styleInliner: StyleInliner,\n    styleUrlResolver: StyleUrlResolver, styleHost) {\n    super();\n    this._templateUrl = templateUrl;\n    this._component = cmpMetadata.type;\n    this._styleInliner = styleInliner;\n    this._styleUrlResolver = styleUrlResolver;\n    this._styleHost = styleHost;\n  }\n\n  process(parent:CompileElement, current:CompileElement, control:CompileControl) {\n    var styleEl = current.element;\n\n    var cssText = DOM.getText(styleEl);\n\n    cssText = this._styleUrlResolver.resolveUrls(cssText, this._templateUrl);\n    var css = this._styleInliner.inlineImports(cssText, this._templateUrl);\n\n    if (PromiseWrapper.isPromise(css)) {\n      DOM.setText(styleEl, '');\n      ListWrapper.push(parent.inheritedProtoView.stylePromises, css);\n      return css.then((css) => {\n        css = _shimCssForComponent(css, this._component);\n        DOM.setText(styleEl, css);\n      });\n    } else {\n      css = _shimCssForComponent(css, this._component);\n      DOM.setText(styleEl, css);\n    }\n\n    DOM.remove(styleEl);\n    _insertStyleElement(this._styleHost, styleEl);\n  }\n}\n\nclass _NativeCssStep extends NS.CompileStep {\n  _styleUrlResolver: StyleUrlResolver;\n  _templateUrl: string;\n\n  constructor(templateUrl: string, styleUrlResover: StyleUrlResolver) {\n    super();\n    this._styleUrlResolver = styleUrlResover;\n    this._templateUrl = templateUrl;\n  }\n\n  process(parent:CompileElement, current:CompileElement, control:CompileControl) {\n    var styleEl = current.element;\n    var cssText = DOM.getText(styleEl);\n    cssText = this._styleUrlResolver.resolveUrls(cssText, this._templateUrl);\n    DOM.setText(styleEl, cssText);\n  }\n}\n\nfunction _moveViewNodesIntoParent(parent, view) {\n  for (var i = 0; i < view.nodes.length; ++i) {\n    DOM.appendChild(parent, view.nodes[i]);\n  }\n}\n\nvar _componentUIDs: Map<Type, int> = MapWrapper.create();\nvar _nextComponentUID: int = 0;\nvar _sharedStyleTexts: Map<string, boolean> = MapWrapper.create();\nvar _lastInsertedStyleEl;\n\nfunction _getComponentId(component: Type) {\n  var id = MapWrapper.get(_componentUIDs, component);\n  if (isBlank(id)) {\n    id = _nextComponentUID++;\n    MapWrapper.set(_componentUIDs, component, id);\n  }\n  return id;\n}\n\nfunction _insertStyleElement(host, styleEl) {\n  if (isBlank(_lastInsertedStyleEl)) {\n    var firstChild = DOM.firstChild(host);\n    if (isPresent(firstChild)) {\n      DOM.insertBefore(firstChild, styleEl);\n    } else {\n      DOM.appendChild(host, styleEl);\n    }\n  } else {\n    DOM.insertAfter(_lastInsertedStyleEl, styleEl);\n  }\n  _lastInsertedStyleEl = styleEl;\n}\n\n// Return the attribute to be added to the component\nfunction _getHostAttribute(id: int) {\n  return `_nghost-${id}`;\n}\n\n// Returns the attribute to be added on every single element nodes in the component\nfunction _getContentAttribute(id: int) {\n  return `_ngcontent-${id}`;\n}\n\nfunction _shimCssForComponent(cssText: string, component: Type): string {\n  var id = _getComponentId(component);\n  var shadowCss = new ShadowCss();\n  return shadowCss.shimCssText(cssText, _getContentAttribute(id), _getHostAttribute(id));\n}\n\n// Reset the caches - used for tests only\nexport function resetShadowDomCache() {\n  MapWrapper.clear(_componentUIDs);\n  _nextComponentUID = 0;\n  MapWrapper.clear(_sharedStyleTexts);\n  _lastInsertedStyleEl = null;\n}\n"]}