{"version":3,"sources":["directive_parser.js"],"names":[],"mappings":"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","file":"/Users/tbosch/projects/angular2/modules/angular2/src/core/compiler/pipeline/directive_parser.js","sourcesContent":["import {isPresent, isBlank, BaseException, assertionsEnabled, RegExpWrapper} from 'angular2/src/facade/lang';\nimport {List, MapWrapper} from 'angular2/src/facade/collection';\nimport {DOM} from 'angular2/src/dom/dom_adapter';\nimport {SelectorMatcher} from '../selector';\nimport {CssSelector} from '../selector';\n\nimport {DirectiveMetadata} from '../directive_metadata';\nimport {DynamicComponent, Component, Viewport} from '../../annotations/annotations';\nimport {CompileStep} from './compile_step';\nimport {CompileElement} from './compile_element';\nimport {CompileControl} from './compile_control';\n\nvar PROPERTY_BINDING_REGEXP = RegExpWrapper.create('^ *([^\\\\s\\\\|]+)');\n\n/**\n * Parses the directives on a single element. Assumes ViewSplitter has already created\n * <template> elements for template directives.\n *\n * Fills:\n * - CompileElement#decoratorDirectives\n * - CompileElement#templateDirecitve\n * - CompileElement#componentDirective.\n *\n * Reads:\n * - CompileElement#propertyBindings (to find directives contained\n *   in the property bindings)\n * - CompileElement#variableBindings (to find directives contained\n *   in the variable bindings)\n */\nexport class DirectiveParser extends CompileStep {\n  _selectorMatcher:SelectorMatcher;\n  constructor(directives:List<DirectiveMetadata>) {\n    super();\n    var selector;\n\n    this._selectorMatcher = new SelectorMatcher();\n    for (var i=0; i<directives.length; i++) {\n      var directiveMetadata = directives[i];\n      selector = CssSelector.parse(directiveMetadata.annotation.selector);\n      this._selectorMatcher.addSelectables(selector, directiveMetadata);\n    }\n  }\n\n  process(parent:CompileElement, current:CompileElement, control:CompileControl) {\n    var attrs = current.attrs();\n    var classList = current.classList();\n\n    var cssSelector = new CssSelector();\n    var nodeName = DOM.nodeName(current.element);\n    cssSelector.setElement(nodeName);\n    for (var i=0; i < classList.length; i++) {\n      cssSelector.addClassName(classList[i]);\n    }\n\n    MapWrapper.forEach(attrs, (attrValue, attrName) => {\n      cssSelector.addAttribute(attrName, attrValue);\n    });\n\n    // Note: We assume that the ViewSplitter already did its work, i.e. template directive should\n    // only be present on <template> elements!\n    var isTemplateElement = DOM.isTemplateElement(current.element);\n\n    this._selectorMatcher.match(cssSelector, (selector, directive) => {\n      current.addDirective(checkDirectiveValidity(directive, current, isTemplateElement));\n    });\n  }\n}\n\n// check if the directive is compatible with the current element\nfunction checkDirectiveValidity(directive, current, isTemplateElement) {\n  var isComponent = directive.annotation instanceof Component || directive.annotation instanceof DynamicComponent;\n  var alreadyHasComponent = isPresent(current.componentDirective);\n\n  if (directive.annotation instanceof Viewport) {\n    if (!isTemplateElement) {\n      throw new BaseException(`Viewport directives need to be placed on <template> elements or elements ` +\n         `with template attribute - check ${current.elementDescription}`);\n    } else if (isPresent(current.viewportDirective)) {\n      throw new BaseException(`Only one viewport directive can be used per element - check ${current.elementDescription}`);\n    }\n  } else if (isTemplateElement) {\n    throw new BaseException(`Only template directives are allowed on template elements - check ${current.elementDescription}`);\n\n  } else if (isComponent && alreadyHasComponent) {\n    throw new BaseException(`Multiple component directives not allowed on the same element - check ${current.elementDescription}`);\n  }\n\n  return directive;\n}\n"]}