{"version":3,"sources":["compiler.js"],"names":[],"mappings":"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","file":"/Users/tbosch/projects/angular2/modules/angular2/src/core/compiler/compiler.js","sourcesContent":["import {Injectable} from 'angular2/di';\nimport {Type, isBlank, isPresent, BaseException, normalizeBlank, stringify} from 'angular2/src/facade/lang';\nimport {Promise, PromiseWrapper} from 'angular2/src/facade/async';\nimport {List, ListWrapper, Map, MapWrapper} from 'angular2/src/facade/collection';\n\nimport {ChangeDetection, Parser} from 'angular2/change_detection';\n\nimport {DirectiveMetadataReader} from './directive_metadata_reader';\nimport {ProtoView} from './view';\nimport {CompilePipeline} from './pipeline/compile_pipeline';\nimport {CompileElement} from './pipeline/compile_element';\nimport {createDefaultSteps} from './pipeline/default_steps';\nimport {TemplateLoader} from './template_loader';\nimport {TemplateResolver} from './template_resolver';\nimport {Template} from '../annotations/template';\nimport {ShadowDomStrategy} from './shadow_dom_strategy';\nimport {CompileStep} from './pipeline/compile_step';\nimport {ComponentUrlMapper} from './component_url_mapper';\nimport {UrlResolver} from './url_resolver';\nimport {CssProcessor} from './css_processor';\n\n/**\n * Cache that stores the ProtoView of the template of a component.\n * Used to prevent duplicate work and resolve cyclic dependencies.\n * @publicModule angular2/angular2\n */\n@Injectable()\nexport class CompilerCache {\n  _cache:Map;\n  constructor() {\n    this._cache = MapWrapper.create();\n  }\n\n  set(component:Type, protoView:ProtoView) {\n    MapWrapper.set(this._cache, component, protoView);\n  }\n\n  get(component:Type):ProtoView {\n    var result = MapWrapper.get(this._cache, component);\n    return normalizeBlank(result);\n  }\n\n  clear() {\n    MapWrapper.clear(this._cache);\n  }\n}\n\n/**\n * The compiler loads and translates the html templates of components into\n * nested ProtoViews. To decompose its functionality it uses\n * the CompilePipeline and the CompileSteps.\n * @publicModule angular2/angular2\n */\n@Injectable()\nexport class Compiler {\n  _reader: DirectiveMetadataReader;\n  _parser:Parser;\n  _compilerCache:CompilerCache;\n  _changeDetection:ChangeDetection;\n  _templateLoader:TemplateLoader;\n  _compiling:Map<Type, Promise>;\n  _shadowDomStrategy: ShadowDomStrategy;\n  _templateResolver: TemplateResolver;\n  _componentUrlMapper: ComponentUrlMapper;\n  _urlResolver: UrlResolver;\n  _appUrl: string;\n  _cssProcessor: CssProcessor;\n\n  constructor(changeDetection:ChangeDetection,\n              templateLoader:TemplateLoader,\n              reader: DirectiveMetadataReader,\n              parser:Parser,\n              cache:CompilerCache,\n              shadowDomStrategy: ShadowDomStrategy,\n              templateResolver: TemplateResolver,\n              componentUrlMapper: ComponentUrlMapper,\n              urlResolver: UrlResolver,\n              cssProcessor: CssProcessor) {\n    this._changeDetection = changeDetection;\n    this._reader = reader;\n    this._parser = parser;\n    this._compilerCache = cache;\n    this._templateLoader = templateLoader;\n    this._compiling = MapWrapper.create();\n    this._shadowDomStrategy = shadowDomStrategy;\n    this._templateResolver = templateResolver;\n    this._componentUrlMapper = componentUrlMapper;\n    this._urlResolver = urlResolver;\n    this._appUrl = urlResolver.resolve(null, './');\n    this._cssProcessor = cssProcessor;\n  }\n\n  createSteps(component:Type, template: Template):List<CompileStep> {\n    var dirMetadata = ListWrapper.map(this._flattenDirectives(template),\n      (d) => this._reader.read(d));\n\n    var cmpMetadata = this._reader.read(component);\n\n    var templateUrl = this._templateLoader.getTemplateUrl(template);\n\n    return createDefaultSteps(this._changeDetection, this._parser, cmpMetadata, dirMetadata,\n      this._shadowDomStrategy, templateUrl, this._cssProcessor);\n  }\n\n  compile(component: Type):Promise<ProtoView> {\n    var protoView = this._compile(component);\n    return PromiseWrapper.isPromise(protoView) ? protoView : PromiseWrapper.resolve(protoView);\n  }\n\n  // TODO(vicb): union type return ProtoView or Promise<ProtoView>\n  _compile(component: Type) {\n    var protoView = this._compilerCache.get(component);\n    if (isPresent(protoView)) {\n      // The component has already been compiled into a ProtoView,\n      // returns a resolved Promise.\n      return protoView;\n    }\n\n    var pvPromise = MapWrapper.get(this._compiling, component);\n    if (isPresent(pvPromise)) {\n      // The component is already being compiled, attach to the existing Promise\n      // instead of re-compiling the component.\n      // It happens when a template references a component multiple times.\n      return pvPromise;\n    }\n\n    var template = this._templateResolver.resolve(component);\n\n    var componentUrl = this._componentUrlMapper.getUrl(component);\n    var baseUrl = this._urlResolver.resolve(this._appUrl, componentUrl);\n    this._templateLoader.setBaseUrl(template, baseUrl);\n\n    var tplElement = this._templateLoader.load(template);\n\n    if (PromiseWrapper.isPromise(tplElement)) {\n      pvPromise = PromiseWrapper.then(tplElement,\n        (el) => this._compileTemplate(template, el, component),\n        (_) => { throw new BaseException(`Failed to load the template for ${stringify(component)}`); }\n      );\n      MapWrapper.set(this._compiling, component, pvPromise);\n      return pvPromise;\n    }\n\n    return this._compileTemplate(template, tplElement, component);\n  }\n\n  // TODO(vicb): union type return ProtoView or Promise<ProtoView>\n  _compileTemplate(template: Template, tplElement, component: Type) {\n    var pipeline = new CompilePipeline(this.createSteps(component, template));\n    var compileElements;\n\n    try {\n      compileElements = pipeline.process(tplElement, stringify(component));\n    } catch(ex) {\n      return PromiseWrapper.reject(ex);\n    }\n\n    var protoView = compileElements[0].inheritedProtoView;\n\n    // Populate the cache before compiling the nested components,\n    // so that components can reference themselves in their template.\n    this._compilerCache.set(component, protoView);\n    MapWrapper.delete(this._compiling, component);\n\n    // Compile all the components from the template\n    var nestedPVPromises = [];\n    for (var i = 0; i < compileElements.length; i++) {\n      var ce = compileElements[i];\n      if (ce.hasNestedView) {\n        this._compileNestedProtoView(ce, nestedPVPromises);\n      }\n    }\n\n    if (protoView.stylePromises.length > 0) {\n      // The protoView is ready after all asynchronous styles are ready\n      var syncProtoView = protoView;\n      protoView = PromiseWrapper.all(syncProtoView.stylePromises).then((_) => syncProtoView);\n    }\n\n    if (nestedPVPromises.length > 0) {\n      // Returns ProtoView Promise when there are any asynchronous nested ProtoViews.\n      // The promise will resolved after nested ProtoViews are compiled.\n      return PromiseWrapper.then(PromiseWrapper.all(nestedPVPromises),\n        (_) => protoView,\n        (e) => { throw new BaseException(`${e.message} -> Failed to compile ${stringify(component)}`); }\n      );\n    }\n\n    return protoView;\n  }\n\n  _compileNestedProtoView(ce: CompileElement, promises: List<Promise>) {\n    var protoView = this._compile(ce.componentDirective.type);\n\n    if (PromiseWrapper.isPromise(protoView)) {\n      ListWrapper.push(\n        promises,\n        protoView.then(function(pv) { ce.inheritedElementBinder.nestedProtoView = pv;})\n      );\n    } else {\n      ce.inheritedElementBinder.nestedProtoView = protoView;\n    }\n  }\n\n  _flattenDirectives(template: Template):List<Type> {\n    if (isBlank(template.directives)) return [];\n\n    var directives = [];\n    this._flattenList(template.directives, directives);\n\n    return directives;\n  }\n\n  _flattenList(tree:List<any>, out:List<Type>) {\n    for (var i = 0; i < tree.length; i++) {\n      var item = tree[i];\n      if (ListWrapper.isList(item)) {\n        this._flattenList(item, out);\n      } else {\n        ListWrapper.push(out, item);\n      }\n    }\n  }\n\n}\n\n\n"]}